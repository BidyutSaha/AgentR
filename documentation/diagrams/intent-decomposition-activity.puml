@startuml intent-decomposition-activity

title Stage 1: Intent Decomposition - Activity Diagram

start

:User submits research abstract;

:Validate input;
note right
  - Check abstract not empty
  - Check length â‰¤ 5000 characters
end note

if (Valid?) then (yes)
  :Extract user ID from JWT token;
  
  :Prepare OpenAI prompt;
  note right
    Structured prompt to extract:
    - Problem statement
    - Proposed solution
    - Methodology
    - Expected contributions
  end note
  
  :Call OpenAI API (GPT-4o-mini);
  
  if (API call successful?) then (yes)
    :Parse LLM response;
    
    :Extract structured components;
    note right
      - problemStatement
      - proposedSolution
      - methodology
      - expectedContributions
    end note
    
    :Return structured output;
    
    :Success response (200 OK);
    
  else (no)
    if (Rate limit exceeded?) then (yes)
      :Return 429 Too Many Requests;
      stop
    else (API error)
      :Log error details;
      :Return 500 Internal Server Error;
      stop
    endif
  endif
  
else (no)
  :Return 400 Bad Request;
  note right
    Error: Invalid input
    - Abstract too long
    - Abstract empty
  end note
  stop
endif

stop

@enduml
